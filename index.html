<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Del Pizza App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ffcc00; /* –ñ–µ–ª—Ç—ã–π */
            --accent: #ff9900;  /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
            --bg: #f9f9f9;
            --text: #333;
            --green: #2ecc71;
            --white: #ffffff;
            --shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px; /* –ú–µ—Å—Ç–æ –ø–æ–¥ –Ω–∏–∂–Ω—é—é –ø–∞–Ω–µ–ª—å */
        }

        /* --- –ù–ê–í–ò–ì–ê–¶–ò–Ø (–¢–ê–ë–´) --- */
        .nav-scroll {
            position: sticky;
            top: 0;
            background: var(--white);
            padding: 10px 0;
            overflow-x: auto;
            white-space: nowrap;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            scrollbar-width: none; /* –°–∫—Ä—ã—Ç—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        }
        .nav-scroll::-webkit-scrollbar { display: none; }
        
        .nav-item {
            display: inline-block;
            padding: 8px 16px;
            margin: 0 5px;
            background: #eee;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            color: #777;
            cursor: pointer;
            transition: all 0.3s;
        }
        .nav-item:first-child { margin-left: 15px; }
        .nav-item.active {
            background: var(--primary);
            color: #000;
            transform: scale(1.05);
        }

        /* --- –ú–ï–ù–Æ (–°–ï–¢–ö–ê) --- */
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 15px;
        }

        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 10px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.1s;
        }
        .card:active { transform: scale(0.98); }
        
        .card img {
            width: 100%;
            height: 110px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 8px;
        }
        
        .card h3 {
            font-size: 15px;
            margin: 0 0 5px;
            line-height: 1.2;
            font-weight: 800;
        }
        
        .card .desc {
            font-size: 11px;
            color: #888;
            margin-bottom: 8px;
            height: 32px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .price {
            font-size: 16px;
            font-weight: 800;
        }

        /* –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" */
        .add-btn {
            background: #f0f0f0;
            color: #333;
            border: none;
            padding: 6px 12px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
        }
        .add-btn.active {
            background: var(--primary);
            color: #000;
        }

        /* --- –ö–û–†–ó–ò–ù–ê (MODAL) --- */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #fff;
            z-index: 2000;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }
        .modal-header {
            padding: 15px;
            background: #fff;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .close-btn { font-size: 24px; cursor: pointer; background: none; border: none; }
        
        .cart-items { padding: 15px; }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .qty-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f0f0f0;
            border-radius: 10px;
            padding: 5px;
        }
        .qty-btn { width: 25px; height: 25px; border: none; background: #fff; border-radius: 6px; font-weight: bold; }

        /* --- –§–û–†–ú–ê –û–§–û–†–ú–õ–ï–ù–ò–Ø --- */
        .order-form { padding: 15px; background: #fafafa; border-radius: 20px; margin: 15px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 13px; color: #777; font-weight: 700; }
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-family: inherit;
            box-sizing: border-box;
        }
        
        .radio-group { display: flex; gap: 10px; }
        .radio-option {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
        }
        .radio-option.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: #000;
        }

        /* --- –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ --- */
        .bottom-bar {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            background: var(--white);
            padding: 10px 15px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
            z-index: 1000;
        }
        .main-btn {
            background: var(--green);
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 14px;
            font-weight: 800;
            font-size: 16px;
            width: 100%;
            text-align: center;
        }
        
        /* –ò–°–¢–û–†–ò–Ø –ó–ê–ö–ê–ó–û–í */
        .history-card { background: #fff; padding: 15px; margin: 10px 15px; border-radius: 15px; border: 1px solid #eee; }
        .history-date { font-size: 12px; color: #999; }
        .history-total { font-weight: 800; color: var(--green); float: right; }

        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        .fade-in { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="nav-scroll" id="nav-bar">
        </div>

    <div id="main-view">
        <div class="container" id="menu-container"></div>
    </div>

    <div id="history-view" style="display: none; padding-bottom: 20px;">
        <h2 style="padding: 15px;">üìú –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>
        <div id="history-list"></div>
        <button onclick="switchView('main')" style="margin: 15px; padding: 10px; border:none; background: #eee; border-radius: 10px;">‚¨ÖÔ∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
    </div>

    <div class="bottom-bar">
        <div style="font-weight: 800; font-size: 18px;" id="total-price">0 ‚ÇΩ</div>
        <button class="main-btn" id="cart-btn" onclick="openCart()">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</button>
    </div>

    <div class="modal" id="cart-modal">
        <div class="modal-header">
            <h2>üõí –ö–æ—Ä–∑–∏–Ω–∞</h2>
            <button class="close-btn" onclick="closeCart()">‚úï</button>
        </div>
        
        <div class="cart-items" id="cart-list"></div>

        <div class="order-form" id="order-form" style="display:none;">
            <h3>üì¶ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
            
            <div class="form-group">
                <label>–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è:</label>
                <div class="radio-group">
                    <div class="radio-option selected" onclick="selectOption('delivery', 'delivery')">üöó –î–æ—Å—Ç–∞–≤–∫–∞</div>
                    <div class="radio-option" onclick="selectOption('delivery', 'pickup')">üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑</div>
                </div>
            </div>

            <div id="address-block" class="form-group">
                <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
                <input type="text" class="form-control" id="address" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞">
            </div>

            <div class="form-group">
                <label>–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="tel" class="form-control" id="phone" placeholder="+7 (9xx) xxx-xx-xx">
            </div>

            <div class="form-group">
                <label>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</label>
                <div class="radio-group">
                    <div class="radio-option selected" onclick="selectOption('payment', 'transfer')">üí≥ –ü–µ—Ä–µ–≤–æ–¥</div>
                    <div class="radio-option" onclick="selectOption('payment', 'yookassa')">üü£ –ÆKassa</div>
                </div>
            </div>
        </div>

        <div style="padding: 15px;">
            <button class="main-btn" id="checkout-btn" onclick="submitOrder()" style="background: var(--primary); color: #000;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // --- –ë–ê–ó–ê –î–ê–ù–ù–´–• ---
    const menuData = [
        {
            category: "–ü–∏—Ü—Ü–∞",
            items: [
                {id: "p_del", name: "Del Pizza", price: 400, desc: "–§–∏—Ä–º–µ–Ω–Ω–∞—è: —Å–æ—É—Å, —Ñ–∏–ª–µ, –∫–æ–ª–±–∞—Å–∞, –≥—Ä–∏–±—ã.", img: "https://avatars.mds.yandex.net/get-sprav-products/13055270/2a0000018f0b4d409929f88063063ee59264/orig"},
                {id: "p_pep", name: "–ü–µ–ø–ø–µ—Ä–æ–Ω–∏", price: 400, desc: "–ö—Ä–∞—Å–Ω—ã–π —Å–æ—É—Å, —Å—ã—Ä, –ø–µ–ø–ø–µ—Ä–æ–Ω–∏.", img: "https://avatars.mds.yandex.net/get-sprav-products/13059590/2a0000018f0b4d413b5c9f7cd772d7f41709/orig"},
                {id: "p_assorti", name: "–ê—Å—Å–æ—Ä—Ç–∏", price: 400, desc: "–°—ã—Ä, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –∫–æ–ª–±–∞—Å–∞, –ø–µ—Ä–µ—Ü.", img: "https://avatars.mds.yandex.net/get-sprav-products/13055270/2a0000018f0b4d413c7c23bc672e85d1ed06/orig"}
            ]
        },
        {
            category: "–§–∞—Å—Ç-—Ñ—É–¥",
            items: [
                {id: "f_burger", name: "–ë—É—Ä–≥–µ—Ä", price: 170, desc: "–°–æ—á–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞, –æ–≤–æ—â–∏.", img: "https://avatars.mds.yandex.net/get-sprav-products/13055270/2a0000018f0b4d407af0011cfdac202b8025/orig"},
                {id: "f_shaurma", name: "–®–∞—É—Ä–º–∞", price: 220, desc: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å –∫—É—Ä–∏—Ü–µ–π.", img: "https://avatars.mds.yandex.net/get-sprav-products/13059590/2a0000018f0b4d42152e8db3ac51db685e7c/orig"}
            ]
        },
        {
            category: "WOK",
            items: [
                {id: "w_noodle", name: "–õ–∞–ø—à–∞ WOK", price: 240, desc: "–£–¥–æ–Ω —Å –∫—É—Ä–∏—Ü–µ–π –∏ —Ç–µ—Ä–∏—è–∫–∏.", img: "https://avatars.mds.yandex.net/get-sprav-products/13059590/2a0000018f0b4d40878fce25082674c41e73/orig"}
            ]
        },
        {
            category: "–ù–∞–ø–∏—Ç–∫–∏",
            items: [
                {id: "d_cola", name: "–ö–æ–ª–∞ 0.5", price: 90, desc: "–•–æ–ª–æ–¥–Ω–∞—è.", img: "https://avatars.mds.yandex.net/get-sprav-products/1540730/2a000001915361d0b242fca0468efedaa7b2/orig"}
            ]
        }
    ];

    let cart = {};
    let currentCategory = "–ü–∏—Ü—Ü–∞";
    let deliveryType = "delivery";
    let paymentType = "transfer";

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
    function init() {
        renderTabs();
        renderMenu();
        loadHistory();
    }

    // --- –û–¢–†–ò–°–û–í–ö–ê –¢–ê–ë–û–í ---
    function renderTabs() {
        const nav = document.getElementById('nav-bar');
        nav.innerHTML = menuData.map(cat => 
            `<div class="nav-item ${cat.category === currentCategory ? 'active' : ''}" 
                  onclick="setCategory('${cat.category}')">${cat.category}</div>`
        ).join('') + `<div class="nav-item" onclick="switchView('history')">üìú –ò—Å—Ç–æ—Ä–∏—è</div>`;
    }

    function setCategory(cat) {
        currentCategory = cat;
        switchView('main');
        renderTabs();
        renderMenu();
    }

    // --- –û–¢–†–ò–°–û–í–ö–ê –ú–ï–ù–Æ ---
    function renderMenu() {
        const container = document.getElementById('menu-container');
        const categoryData = menuData.find(c => c.category === currentCategory);
        
        container.innerHTML = categoryData.items.map(item => {
            const qty = cart[item.id] ? cart[item.id].qty : 0;
            return `
            <div class="card fade-in">
                <img src="${item.img}">
                <h3>${item.name}</h3>
                <div class="desc">${item.desc}</div>
                <div class="card-footer">
                    <div class="price">${item.price} ‚ÇΩ</div>
                    ${qty === 0 
                        ? `<button class="add-btn" onclick="addToCart('${item.id}', '${item.name}', ${item.price})">–î–æ–±–∞–≤–∏—Ç—å</button>`
                        : `<button class="add-btn active" onclick="openCart()">–í –∫–æ—Ä–∑–∏–Ω–µ (${qty})</button>`
                    }
                </div>
            </div>`;
        }).join('');
    }

    // --- –õ–û–ì–ò–ö–ê –ö–û–†–ó–ò–ù–´ ---
    function addToCart(id, name, price) {
        if (!cart[id]) cart[id] = { name, price, qty: 0 };
        cart[id].qty++;
        updateCartUI();
        renderMenu(); // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
    }

    function changeQty(id, change) {
        if (cart[id]) {
            cart[id].qty += change;
            if (cart[id].qty <= 0) delete cart[id];
        }
        updateCartUI();
        renderCartItems();
        renderMenu();
    }

    function updateCartUI() {
        let total = 0;
        let count = 0;
        for (let id in cart) {
            total += cart[id].price * cart[id].qty;
            count += cart[id].qty;
        }
        
        document.getElementById('total-price').innerText = `${total} ‚ÇΩ`;
        const btn = document.getElementById('cart-btn');
        
        if (count > 0) {
            btn.innerText = `–û—Ñ–æ—Ä–º–∏—Ç—å (${count})`;
            btn.style.background = "var(--green)";
        } else {
            btn.innerText = "–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞";
            btn.style.background = "#ccc";
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã
        document.getElementById('order-form').style.display = count > 0 ? 'block' : 'none';
        document.getElementById('checkout-btn').style.display = count > 0 ? 'block' : 'none';
    }

    function openCart() {
        if (Object.keys(cart).length === 0) return;
        document.getElementById('cart-modal').style.display = 'flex';
        renderCartItems();
    }

    function closeCart() {
        document.getElementById('cart-modal').style.display = 'none';
    }

    function renderCartItems() {
        const list = document.getElementById('cart-list');
        if (Object.keys(cart).length === 0) {
            list.innerHTML = "<div style='text-align:center; padding:20px; color:#999'>–ü—É—Å—Ç–æ üòî</div>";
            return;
        }

        list.innerHTML = Object.keys(cart).map(id => {
            const item = cart[id];
            return `
            <div class="cart-item">
                <div>
                    <div style="font-weight:bold">${item.name}</div>
                    <div style="font-size:13px; color:#777">${item.price} ‚ÇΩ</div>
                </div>
                <div class="qty-control">
                    <button class="qty-btn" onclick="changeQty('${id}', -1)">-</button>
                    <span>${item.qty}</span>
                    <button class="qty-btn" onclick="changeQty('${id}', 1)">+</button>
                </div>
            </div>`;
        }).join('');
    }

    // --- –û–§–û–†–ú–õ–ï–ù–ò–ï ---
    function selectOption(group, value) {
        if (group === 'delivery') {
            deliveryType = value;
            document.getElementById('address-block').style.display = value === 'delivery' ? 'block' : 'none';
        } else {
            paymentType = value;
        }
        
        // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
        const options = document.querySelectorAll(`.radio-option[onclick*="'${group}'"]`);
        options.forEach(opt => {
            if (opt.getAttribute('onclick').includes(`'${value}'`)) opt.classList.add('selected');
            else opt.classList.remove('selected');
        });
    }

    function submitOrder() {
        const phone = document.getElementById('phone').value;
        const address = document.getElementById('address').value;

        if (!phone) {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞!");
            return;
        }
        if (deliveryType === 'delivery' && !address) {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏!");
            return;
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        const total = document.getElementById('total-price').innerText;
        saveToHistory(cart, total);

        const data = {
            cart: cart,
            total: total,
            delivery: deliveryType === 'delivery' ? '–î–æ—Å—Ç–∞–≤–∫–∞' : '–°–∞–º–æ–≤—ã–≤–æ–∑',
            address: deliveryType === 'delivery' ? address : '–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è',
            phone: phone,
            payment: paymentType === 'transfer' ? '–ü–µ—Ä–µ–≤–æ–¥/–ù–∞–ª–∏—á–Ω—ã–µ' : '–ÆKassa (–û–Ω–ª–∞–π–Ω)'
        };

        tg.sendData(JSON.stringify(data));
    }

    // --- –ò–°–¢–û–†–ò–Ø ---
    function saveToHistory(orderCart, total) {
        let history = JSON.parse(localStorage.getItem('del_pizza_history') || "[]");
        const date = new Date().toLocaleString("ru-RU", {day: 'numeric', month: 'long', hour:'2-digit', minute:'2-digit'});
        
        // –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
        const summary = Object.values(orderCart).map(i => `${i.name} x${i.qty}`).join(", ");
        
        history.unshift({ date, summary, total });
        if (history.length > 10) history.pop(); // –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10
        localStorage.setItem('del_pizza_history', JSON.stringify(history));
    }

    function loadHistory() {
        const list = document.getElementById('history-list');
        const history = JSON.parse(localStorage.getItem('del_pizza_history') || "[]");
        
        if (history.length === 0) {
            list.innerHTML = "<div style='text-align:center; padding:20px; color:#999'>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>";
            return;
        }

        list.innerHTML = history.map(h => `
            <div class="history-card">
                <div class="history-date">${h.date}</div>
                <div style="margin: 5px 0;">${h.summary}</div>
                <div class="history-total">${h.total}</div>
                <div style="clear:both"></div>
            </div>
        `).join('');
    }

    function switchView(view) {
        document.getElementById('main-view').style.display = view === 'main' ? 'block' : 'none';
        document.getElementById('history-view').style.display = view === 'history' ? 'block' : 'none';
        if (view === 'history') loadHistory();
    }

    // –ó–∞–ø—É—Å–∫
    init();
</script>
</body>
</html>